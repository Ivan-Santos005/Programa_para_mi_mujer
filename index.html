<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cascada y explosiones — Te Amo y Perdóname</title>
<style>
  html,body{
    height:100%;
    margin:0;
    background:#000;
    overflow:hidden;
  }
  canvas{
    display:block;
    width:100vw;
    height:100vh;
  }
</style>
</head>
<body>
  <canvas id="c"></canvas>

<script>
(() => {
  const TEXTS = ["Te Amo", "Perdóname"];  // ❤️ ahora muestra ambos textos
  const COLOR = "#ff83b6";                
  let SPEED_MULTIPLIER = 1.3;             

  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d', { alpha: true });

  let columns = [];
  let particles = [];
  const fontSize = 18; 

  function resize(){
    const ratio = window.devicePixelRatio || 1;
    canvas.width = Math.floor(window.innerWidth * ratio);
    canvas.height = Math.floor(window.innerHeight * ratio);
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(ratio,0,0,ratio,0,0);
    initColumns();
  }
  window.addEventListener('resize', resize);

  function initColumns(){
    columns = [];
    const w = window.innerWidth;
    const columnWidth = 110; 
    const cols = Math.max(6, Math.floor(w / columnWidth));
    for(let i=0;i<cols;i++){
      columns.push({
        x: (i + 0.5) * (w / cols),
        y: Math.random() * window.innerHeight * -1,
        speed: (0.4 + Math.random()*1.2) * SPEED_MULTIPLIER,
        offset: Math.random()*100
      });
    }
  }

  class Particle {
    constructor(x,y,word,color){
      this.x = x; this.y = y;
      const ang = Math.random() * Math.PI*2;
      const mag = 0.8 + Math.random()*2;
      this.vx = Math.cos(ang)*mag;
      this.vy = Math.sin(ang)*mag - 1;
      this.life = 80 + Math.floor(Math.random()*40);
      this.age = 0;
      this.word = word;
      this.color = color;
      this.scale = 0.8 + Math.random()*0.8;
      this.rot = (Math.random()-0.5)*0.4;
    }
    update(){
      this.vy += 0.05;
      this.vx *= 0.99;
      this.vy *= 0.99;
      this.x += this.vx;
      this.y += this.vy;
      this.age++;
    }
    alive(){ return this.age < this.life; }
    draw(ctx){
      const t = 1 - this.age/this.life;
      ctx.save();
      ctx.translate(this.x, this.y);
      ctx.rotate(this.rot * (1-this.age/this.life));
      ctx.globalAlpha = Math.pow(t,1.6);
      ctx.font = `${Math.max(12, Math.floor(fontSize * this.scale))}px monospace`;
      ctx.fillStyle = this.color;
      ctx.fillText(this.word, 0, 0);
      ctx.restore();
    }
  }

  function drawCascade(){
    const w = window.innerWidth;
    const h = window.innerHeight;
    const columnsCount = columns.length;
    
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0.18)';
    ctx.fillRect(0,0,w,h);

    for(let layer=0; layer<3; layer++){
      const alphaBase = 0.18 - layer*0.05;
      for(let i=0;i<columnsCount;i++){
        const col = columns[i];
        const speed = (col.speed + layer*0.5);
        col.y += speed;
        if(col.y > h + 200) col.y = -Math.random() * h - 60;

        const items = Math.floor(h / (fontSize*1.8)) + 6;
        for(let k=0;k<items;k++){
          const ypos = col.y + k * (fontSize * 1.8);
          const jitterX = (Math.sin((col.offset + k*0.5 + Date.now()*0.002))) * 6;
          ctx.globalAlpha = Math.max(0, alphaBase * (1 - Math.abs((k%10 -5)/6)));
          ctx.font = `${fontSize}px monospace`;
          ctx.fillStyle = hexToRgba(COLOR, ctx.globalAlpha);

          // Alternar entre los textos
          const text = TEXTS[(i + k) % TEXTS.length];
          ctx.fillText(text, col.x + jitterX - (text.length * fontSize * 0.14), ypos);
        }
      }
    }

    ctx.globalAlpha = 0.12;
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,w,h);
    ctx.restore();
  }

  function hexToRgba(hex, alpha=1){
    let c = hex.replace('#','');
    if(c.length===3) c = c.split('').map(ch=>ch+ch).join('');
    const r = parseInt(c.substring(0,2),16);
    const g = parseInt(c.substring(2,4),16);
    const b = parseInt(c.substring(4,6),16);
    return `rgba(${r},${g},${b},${alpha})`;
  }

  function explode(x,y){
    const count = 24 + Math.floor(Math.random()*20);
    for(let i=0;i<count;i++){
      const text = TEXTS[i % TEXTS.length]; // Explosión también alterna “Te Amo” y “Perdóname”
      particles.push(new Particle(x, y, text, COLOR));
    }
  }

  function onPointer(e){
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
    const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;
    explode(x, y);
  }
  window.addEventListener('pointerdown', onPointer);
  window.addEventListener('touchstart', onPointer, {passive:true});

  function loop(){
    drawCascade();
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.update();
      p.draw(ctx);
      if(!p.alive()) particles.splice(i,1);
    }
    requestAnimationFrame(loop);
  }

  resize();
  loop();

  setTimeout(()=>{
    explode(window.innerWidth*0.4, window.innerHeight*0.45);
    explode(window.innerWidth*0.6, window.innerHeight*0.6);
  },600);
})();
</script>
</body>
</html>
